<?php
	$cart_list = isset($cart_list) && !empty($cart_list) ? $cart_list : array();
?>
<div id="cart_item_container">
	<?php foreach($lookup as $status => $friendly_status): ?>
		<?php if(!array_key_exists($status, $categories)): ?>
			<?php continue; ?>
		<?php endif; ?>
		<div id="<?= $status ?>_cart_container" class="cart_tree form_container">
			<h2><?= $friendly_status ?></h2>
			<table style="width:100%;">
				<thead>
					<tr>
						<th>&nbsp;</th>
						<th>Name</th>
						<th>Size</th>
						<th>File Count</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
				<tbody>
				<?php foreach($categories[$status] as $cart_uuid): ?>
					<?php $cart_entry = $cart_list[$cart_uuid]; ?>
					<tr id="cart_line_<?= $cart_uuid ?>" class="cart_line">
						<td>
							<?php if($status == 'ready'): ?>
							<a href="<?= $cart_entry['user_download_url'] ?>">Download</a>
							<?php else: ?>
							&mdash;&mdash;&mdash;
							<?php endif; ?>
						</td>
						<td>
							<div>
								<?= $cart_entry['name'] ?>
							</div>
							<?php if(!empty($cart_entry['description'])): ?>
							<div style="font-size:0.85em;">
								<?= $cart_entry['description'] ?>
							</div>
							<?php endif; ?>
						</td>
						<?php
			              $display_size_text = $cart_entry['total_file_size_bytes'] ? $cart_entry['friendly_file_size'] : "Unknown";
			            ?>
						<td>
							<?= $display_size_text ?>
						</td>
			            <td>
							<?php $pluralizer = $cart_entry['total_file_count'] != 1 ? "s" : ""; ?>
							<?= $cart_entry['total_file_count'] ?> file<?= $pluralizer ?>
						</td>
						<td>
			              <div class="buttons">
			                <input
			                  type="button"
			                  id="delete_button_<?= $cart_uuid ?>"
			                  name="delete_button_<?= $cart_uuid ?>"
			                  class="cart_delete_button state_<?= $status ?>"
			                  title="Delete this queued download"
			                  value="X" />
			              </div>
			            </td>
					</tr>
				<?php endforeach; ?>
				</tbody>
			</table>
		</div>
	<?php endforeach; ?>
</div>
<div id="cart_list_messages" class="cart_list_message_container"></div>
<script type="application/javascript">
$(function(){
    var del_buttons = $('.cart_delete_button');
    $.each(del_buttons, function(index, el){
      	el = $(el);
		el.on('click', function(){
        	var cart_id = el.prop('id').replace('delete_button_','');
        	var dialog_message = $('<div><p>Really delete this cart?</p></div>');
        	dialog_message.dialog({
	          	modal:true,
	          	buttons: {
	            	Delete: function(){
                		cart_delete(cart_id);
	              		$(this).dialog("close");
	            	},
	            	Cancel: function(){
	              		$(this).dialog("close");
	              		return false;
	            	}
	          	}
        	});
      	});
    });
  });
</script>
